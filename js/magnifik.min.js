/*! mobify-maginifik 0.1.0 2013-07-20 */
(function(){var t=window.Mobify=window.Mobify||{},s=t.$=t.$||window.$||window.Zepto||window.jQuery;t.UI=t.UI||{classPrefix:"m-"};var s=window.Mobify?t.$:window.$;t.UI.Magnifik=function(){var i={stage:void 0,classNames:{zooming:"zooming",close:"close",control:"magnifikControl",canvas:"magnifikCanvas",thumb:"magnifikThumb",full:"magnifikFull"},ratio:2,seekImage:!0,clickCloses:!0,activationEvent:"click",canvasStyle:{position:"absolute",width:"100%",height:"100%",overflow:"auto"},imageStyle:{position:"absolute",top:"0",left:"0",maxWidth:"none",maxHeight:"none"},stageHTML:function(){return'<div class="'+this._getClass("canvas")+'"><img class="'+this._getClass("thumb")+'"><img class="'+this._getClass("full")+'"></div>'},globalStyle:function(){var t="."+this._getClass("zooming");return t+" { overflow: hidden; }"+t+" > * { display: none !important; }"+t+" > ."+this._getClass("control")+" { display: block !important; }"}},e=function(t,o){this.options=s.extend({},e.defaults,o),this.options.classNames=s.extend(i.classNames,this.options.classNames),this.options.imageStyle.width=100*this.options.ratio+"%",this.options.stage||(this.options.stage=s("body"),this.options.global=!0),this.$element=s(t),this.bind()};return e.defaults=i,e.prototype.unbind=function(){return this.bind(!0)},e.prototype.makeElems=function(){if(this.$stage=this.options.stage,this.$canvas=s(this.options.stageHTML.call(this)).addClass(this._getClass("control")),this.$canvas.first().css(this.options.canvasStyle),this.$thumb=this.$canvas.find("."+this._getClass("thumb")).css(this.options.imageStyle),this.$full=this.$canvas.find("."+this._getClass("full")).css(this.options.imageStyle),this.options.clickCloses&&this.$canvas.first().addClass(this._getClass("close")),this.options.global){if(!s('style[data-magnifik="'+this._getClass("zooming")+'"]').length){var t=document.createElement("style"),i=this.options.globalStyle.call(this);t.setAttribute("type","text/css"),t.styleSheet?t.styleSheet.cssText=i:t.appendChild(document.createTextNode(i)),s("head")[0].appendChild(t)}}else this.$stage.css("position","relative");var e="."+this._getClass("close");this.$close=this.$canvas.find(e).add(this.$canvas.filter(e)),this.bindClose("bind")},e.prototype.close=function(){this.isOpen&&(this.isOpen=!1,this.$element.trigger("closing.magnifik"),this.$canvas.detach(),this.$stage.removeClass(this._getClass("zooming")),this.options.global&&(document.body.scrollTop=this.oldScrollTop),this.$element.trigger("close.magnifik"))},e.prototype.open=function(t){if(t.preventDefault(),!this.isOpen){this.isOpen=!0,this.$element.trigger("opening.magnifik"),this.$stage||this.makeElems();var i,e,o,n=.5,a=.5,l=s(t.target);if("IMG"!==t.target.tagName){var h=this.$element;this.options.seekImage&&(h=h.add(this.$element.parents()));for(var r=0;h.length>r;++r)if(e=s(h[r]).find("img"),e.length){l=e;break}}else n=t.offsetX/l.prop("offsetWidth"),a=t.offsetY/l.prop("offsetHeight");i=l.filter("[href]").add(l.parent("[href]")),o=i.attr("href")||l.attr("src"),this.$thumb.attr("src",l.attr("src")),this.$full.attr("src",o),this.options.global&&(this.oldScrollTop=document.body.scrollTop),this.$stage.append(this.$canvas),this.$stage.addClass(this._getClass("zooming"));var c=l.prop("naturalHeight")/l.prop("naturalWidth"),p=this.$thumb.prop("offsetWidth"),f=this.$canvas.prop("offsetWidth"),g=p,d=this.$canvas.prop("offsetHeight"),m=p*c,u=this;this.$thumb.one("load",function(){u.$canvas.prop("scrollLeft",Math.max(0,Math.min(g-f,g*n-f/2))),u.$canvas.prop("scrollTop",Math.max(0,Math.min(m-d,m*a-d/2))),u.$element.trigger("open.magnifik")})}},e.prototype.bindClose=function(t){this.$close&&this.$close[t](this.options.activationEvent,this.boundClose)},e.prototype.bind=function(t){var s=this,i=t?"unbind":"bind";this.boundClose=this.boundClose||function(){return s.close.apply(s,arguments)},this.boundOpen=this.boundOpen||function(){return s.open.apply(s,arguments)},this.$element[i](this.options.activationEvent,this.boundOpen),this.bindClose(i)},e.prototype._getClass=function(s){var i=this.options.classPrefix;return i===void 0&&(i=t.UI.classPrefix),i+this.options.classNames[s]},e}(),s.fn.magnifik=function(i,e){var o="Mobify.UI.Magnifik",n=s.extend({},s.fn.magnifik.defaults);return"object"==typeof i&&(n=i,e=null,i=null),this.each(function(){var a=s(this),l=a.data(o);l||(l=new t.UI.Magnifik(this,n)),i&&(l[i](e),"destroy"===i&&(a.data(o,null),a.$canvas.remove())),a.data(o,l)}),this}})();